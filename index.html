<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Simple Calendar - Two Days Ahead or Next Monday</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 10px;
    position: relative;
  }
  .calendar, .time-slots {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 4px;
    font-size: 0.9em;
  }
  .header {
    font-weight: bold;
    text-align: center;
  }
  .day, .time-slot {
    width: 60px;
    height: 30px;
    line-height: 30px;
    text-align: center;
    border-radius: 4px;
    cursor: default;
    user-select: none;
  }
  .day.booked, .time-slot.booked {
    color: #ccc;
    background-color: #e0e0e0;
    cursor: not-allowed;
    text-decoration: line-through;
  }
  .day.enabled, .time-slot.enabled {
    background-color: #f0f0f0;
    cursor: pointer;
  }
  /* Optional: hover effect for enabled days and time slots */
  .day.enabled:hover, .time-slot.enabled:hover {
    background-color: #ddd;
  }
  /* Confirmation popup style */
  #confirmationPopup {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    background-color: #333;
    color: white;
    padding: 10px 15px;
    border-radius: 6px;
    font-size: 0.9em;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
    z-index: 9999;
    display: flex;
    align-items: center;
    gap: 10px;
    max-width: 90vw;
    word-break: break-word;
  }
  #confirmationPopup.show {
    opacity: 1;
    pointer-events: auto;
  }
  #confirmationPopup button {
    background: #555;
    color: white;
    border: none;
    border-radius: 4px;
    padding: 4px 8px;
    cursor: pointer;
    font-size: 0.85em;
  }
  #confirmationPopup button:hover {
    background: #777;
  }
  /* Back button for time selection page */
  #backToDateBtn {
    margin-bottom: 10px;
    padding: 6px 12px;
    font-size: 1em;
    cursor: pointer;
    border-radius: 4px;
    border: 1px solid #ccc;
    background-color: #fafafa;
    transition: background-color 0.2s ease;
  }
  #backToDateBtn:hover {
    background-color: #eee;
  }
  /* Time slots container styling for fewer columns */
  .time-slots {
    grid-template-columns: repeat(4, 1fr);
    max-width: 280px;
  }
</style>
</head>
<body>
  <div id="calendarContainer"></div>
  <div id="timeSlotsContainer" style="display:none;">
    <button id="backToDateBtn">&larr; Back to Date Selection</button>
    <div id="timeSlots" class="time-slots"></div>
  </div>

  <!-- Confirmation popup -->
  <div id="confirmationPopup">
    <span id="confirmationMessage"></span>
    <button id="closePopupBtn">OK</button>
  </div>

<script>
(function() {
  const calendarContainer = document.getElementById('calendarContainer');
  const timeSlotsContainer = document.getElementById('timeSlotsContainer');
  const timeSlotsDiv = document.getElementById('timeSlots');
  const backToDateBtn = document.getElementById('backToDateBtn');
  const confirmationPopup = document.getElementById('confirmationPopup');
  const confirmationMessage = document.getElementById('confirmationMessage');
  const closePopupBtn = document.getElementById('closePopupBtn');

  let selectedDate = null;

  const today = new Date();

  // Calculate candidate date 2 days ahead
  const candidateDate = new Date(today);
  candidateDate.setDate(candidateDate.getDate() + 2);

  // If candidate falls on Saturday (6) or Sunday (0), set to next Monday
  const candidateDay = candidateDate.getDay();
  if (candidateDay === 6) {
    // Saturday -> add 2 days to Monday
    candidateDate.setDate(candidateDate.getDate() + 2);
  } else if (candidateDay === 0) {
    // Sunday -> add 1 day to Monday
    candidateDate.setDate(candidateDate.getDate() + 1);
  }

  const targetYear = candidateDate.getFullYear();
  const targetMonth = candidateDate.getMonth();
  const targetDay = candidateDate.getDate();

  // Build calendar for the current month only
  const currentYear = today.getFullYear();
  const currentMonth = today.getMonth();

  const firstDayOfMonth = new Date(currentYear, currentMonth, 1);
  const lastDayOfMonth = new Date(currentYear, currentMonth + 1, 0);
  const totalDays = lastDayOfMonth.getDate();

  const startDay = firstDayOfMonth.getDay();

  const daysArray = [];

  for (let i = 0; i < startDay; i++) {
    daysArray.push(null);
  }

  for (let d = 1; d <= totalDays; d++) {
    daysArray.push(d);
  }

  const weekdays = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
  const calendarDiv = document.createElement('div');
  calendarDiv.className = 'calendar';

  weekdays.forEach(day => {
    const headerCell = document.createElement('div');
    headerCell.className = 'header';
    headerCell.textContent = day;
    calendarDiv.appendChild(headerCell);
  });

  calendarContainer.appendChild(calendarDiv);

  function showConfirmation(message) {
    confirmationMessage.textContent = message;
    confirmationPopup.classList.add('show');
  }

  closePopupBtn.addEventListener('click', () => {
    confirmationPopup.classList.remove('show');

    // Close the webview after user dismisses confirmation
    if (window.ReactNativeWebView && window.ReactNativeWebView.postMessage) {
      window.ReactNativeWebView.postMessage('close');
    }
    if (window.webkit && window.webkit.messageHandlers && window.webkit.messageHandlers.close) {
      window.webkit.messageHandlers.close.postMessage('close');
    }
    setTimeout(() => {
      window.close();
    }, 50);
  });

  // Render days
  daysArray.forEach(day => {
    const dayDiv = document.createElement('div');
    dayDiv.className = 'day';

    if (day === null) {
      dayDiv.innerHTML = '&nbsp;';
    } else {
      // Enable only the target day, all others booked
      const isTargetDay =
        day === targetDay &&
        currentMonth === targetMonth &&
        currentYear === targetYear;

      if (isTargetDay) {
        dayDiv.classList.add('enabled');
        dayDiv.textContent = day;

        dayDiv.addEventListener('click', () => {
          selectedDate = new Date(targetYear, targetMonth, day);
          // Hide calendar, show time slots page
          calendarContainer.style.display = 'none';
          timeSlotsContainer.style.display = 'block';
          renderTimeSlots();
        });
      } else {
        dayDiv.classList.add('booked');
        dayDiv.textContent = day;
      }
    }

    calendarDiv.appendChild(dayDiv);
  });

  backToDateBtn.addEventListener('click', () => {
    // Back to calendar selection
    timeSlotsContainer.style.display = 'none';
    calendarContainer.style.display = 'block';
  });

  function renderTimeSlots() {
    timeSlotsDiv.innerHTML = ''; // clear previous slots

    // We generate slots from 10:00 to 18:00 â€” half-hour increments
    // Only 14:30 is enabled
    const startHour = 10;
    const endHour = 18;

    for (let hour = startHour; hour <= endHour; hour++) {
      // Full hour slot (e.g., 10:00, 11:00 ...)
      let timeStr = `${hour.toString().padStart(2, '0')}:00`;
      createTimeSlotDiv(timeStr, false); // disabled

      // Half hour slot only showing 14:30 enabled
      if (hour < endHour) { // skip after 18:00
        timeStr = `${hour.toString().padStart(2, '0')}:30`;
        // Enabled only if 14:30
        const isEnabled = timeStr === '14:30';
        createTimeSlotDiv(timeStr, isEnabled);
      }
    }
  }

  function createTimeSlotDiv(timeStr, enabled) {
    const slotDiv = document.createElement('div');
    slotDiv.classList.add('time-slot');
    slotDiv.textContent = timeStr;
    if (enabled) {
      slotDiv.classList.add('enabled');
      slotDiv.title = 'Click to select this time';
      slotDiv.addEventListener('click', () => {
        // On time selected: show confirmation popup with full datetime
        const dayStr = String(selectedDate.getDate()).padStart(2, '0');
        const monthStr = String(selectedDate.getMonth() + 1).padStart(2, '0');
        const yearStr = selectedDate.getFullYear();
        showConfirmation(`Selected date & time: ${dayStr}.${monthStr}.${yearStr} ${timeStr}`);
      });
    } else {
      slotDiv.classList.add('booked');
      slotDiv.title = 'Not available';
    }
    timeSlotsDiv.appendChild(slotDiv);
  }
})();
</script>
</body>
</html>
